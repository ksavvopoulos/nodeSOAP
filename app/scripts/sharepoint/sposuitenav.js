function RenderSuiteLinksFromShellData(suiteLinksDiv,suiteVersion,dataCallback,isMobile){var _allDocumentsLinkId="ShellDocuments",_allSitesLinkId="ShellSites",_retryTimeoutInterval=4e3,_dataRetrieved=false,_fetchingData=false,_jsProtocol="javascript:",_themeInfoKey="SPSuiteThemeInfo",_mySiteHostWebTemplate=54,_mySitePersonalWebTemplate=21,_tenantAdminWebTemplate=16;if(typeof suiteVersion!="number"||suiteVersion<1)suiteVersion=1;function With15FallbackShellData(b){function a(){var a=typeof g_SpoSuiteNavSettings=="undefined"?{FallbackCss:null,FallbackJsKey:null}:g_SpoSuiteNavSettings,c={ClientData:JSON.stringify({IsRTL:document.documentElement.getAttribute("dir")=="rtl"}),Dimensions:{Top:"30px"},HelpLink:{Id:"HelpLink",MenuName:null,SubLinks:null,TargetWindow:"_blank",Text:Strings.CMS.L_HelpToolTip_TEXT,Url:null},IsAuthenticated:true,SignOutLink:{Id:"ShellSignout",MenuName:null,SubLinks:null,TargetWindow:null,Text:null,Url:null},StringsOverride:{l_ShellCore_Help_Text:Strings.CMS.L_HelpToolTip_TEXT,l_ShellCore_Settings_Text:Strings.STS.L_Settings_Text},UserDisplayName:null},d={DoNotCache:true,JsKey:a.FallbackJsKey,CssUrl:a.FallbackCss,SPSuiteVersion:suiteVersion,NavBarData:c};b(d)}if(typeof Strings!="undefined"&&Strings.CMS!=null&&Strings.CMS.L_HelpToolTip_TEXT!=null)a();else SP.SOD.executeFunc("strings.js","Strings.CMS.L_HelpToolTip_TEXT",a)}function GetLocalStorageValue(b){try{return localStorage[b]}catch(a){return null}}function SetLocalStorageValue(c,b){try{localStorage[c]=b}catch(a){}}function GetWebTemplate(){var a=-1;if(typeof _spPageContextInfo!="undefined")a=parseInt(_spPageContextInfo.webTemplate);return a}function ReplaceDocumentsAndSitesLinks(d,c,e){for(var b=0;b<d.length;b++){var a=d[b];if(Boolean(a)){if(c!=null&&a.Id==_allDocumentsLinkId)a.Url=c;if(e!=null&&a.Id==_allSitesLinkId)a.Url=e}}}function GetCachedMySiteData(){try{var a=JSON.parse(localStorage.SPMySiteLinks),b=Date.parse(a.CacheDate);if(b>0&&(new Date).getTime()-b<24*60*60*1e3&&GetCurrentUserKey()==a.UserKey)return a}catch(c){}return null}function FetchMySiteLinks(d,b){var a=null,c=null;function f(b,c,d){var a={};a.AllDocumentsLink=c;a.AllSitesLink=d;b(JSON.stringify(a))}function h(b){var c=_spPageContextInfo.webServerRelativeUrl=="/"?"":_spPageContextInfo.webServerRelativeUrl,d=escapeUrlForCallback(c)+"/_api/Microsoft.SharePoint.Portal.UserProfiles.MySiteLinks.GetMySiteLinks",a=new XMLHttpRequest;a.open("GET",d,true);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.setRequestHeader("ACCEPT","application/json; odata=verbose");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){var c=null;try{c=JSON.parse(a.responseText)}catch(d){if(typeof Sys!=="undefined"&&typeof Sys.Debug!=="undefined");}if(Boolean(c)&&Boolean(c.d)&&(Boolean(c.d.AllDocumentsLink)||Boolean(c.d.AllSitesLink))){f(b,c.d.AllDocumentsLink,c.d.AllSitesLink);return}}f(b,null,null)}};a.send()}function i(g){if(!Boolean(g)){if(typeof Sys!=="undefined"&&typeof Sys.Debug!=="undefined");b(d);return}var e=JSON.parse(g);if(e!=null){var f=e.AllDocumentsLink,h=e.AllSitesLink;try{localStorage.SPMySiteLinks=JSON.stringify({Docs:f,Sites:h,CacheDate:new Date,UserKey:GetCurrentUserKey()})}catch(j){}ReplaceDocumentsAndSitesLinks(c,f,h)}var i=JSON.stringify(a);b(i)}try{a=JSON.parse(d)}catch(j){if(typeof Sys!=="undefined"&&typeof Sys.Debug!=="undefined");}if(a!=null){var g=ExtractSuiteNavBarData(a);c=g!=null?g.WorkloadLinks:a.WorkloadLinks}var e=GetCachedMySiteData();if(c==null)b(d);else if(e!=null){ReplaceDocumentsAndSitesLinks(c,e.Docs,e.Sites);b(JSON.stringify(a))}else h(i)}function FetchLinksFromServer(c){if(window.XMLHttpRequest==null)return;function d(){if(_retryTimeoutInterval<30*60*1e3){var a=setTimeout(function(){FetchLinksFromServer(c)},_retryTimeoutInterval);AddEvtHandler(window,"onunload",function(){clearTimeout(a)});_retryTimeoutInterval=_retryTimeoutInterval*2}}if(_fetchingData)return;_fetchingData=true;var e=_spPageContextInfo.webServerRelativeUrl=="/"?"":_spPageContextInfo.webServerRelativeUrl,a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState!=4||_dataRetrieved)return;_fetchingData=false;if(a.status==200){_dataRetrieved=true;var b=false;if(suiteVersion>=2&&!Boolean(isMobile)){var e=a.getResponseHeader("Content-Type");if(e==null&&e.indexOf("application/json")<0){With15FallbackShellData(function(a){c(JSON.stringify(a))});b=true}}!b&&FetchMySiteLinks(a.responseText,c)}else d()};a.ontimeout=d;var b="/_layouts/online/handlers/SpoSuiteLinks.ashx";b=escapeUrlForCallback(e)+(typeof ajaxNavigate!=="undefined"?ajaxNavigate._fixLayoutsUrl(b):typeof FixLayoutsUrl!=="undefined"?FixLayoutsUrl(b):b);a.open("POST",b+"?Locale="+escapeUrlForCallback(_spPageContextInfo.currentUICultureName)+"&v="+String(suiteVersion)+"&mobilereq="+String(isMobile===true?1:0),true);a.send("");return null}function UpdateActiveLink(a){var i="ShellAdmin",d="ShellNewsfeed",h="ShellProject",g=16,f=6221,e=700;if(a==null)return;var c=function(){for(var c=a.WorkloadLinks||[],b=0;b<c.length;b++)if(c[b].Id===d)return d;return _allSitesLinkId}(),j=GetWebTemplate();switch(j){case g:a.CurrentMainLinkElementID=i;break;case _mySiteHostWebTemplate:a.CurrentMainLinkElementID=c;break;case f:a.CurrentMainLinkElementID=h;break;case _mySitePersonalWebTemplate:if(typeof g_wsaListTemplateId!="undefined"&&g_wsaListTemplateId==e)a.CurrentMainLinkElementID=_allDocumentsLinkId;else{a.CurrentMainLinkElementID=c;var k=new URI(ajaxNavigate.get_href()),b=k.getPath(true);if(Boolean(b))if(b.toLowerCase().endsWith("/social/followedcontent.aspx"))a.CurrentMainLinkElementID=_allDocumentsLinkId;else if(b.toLowerCase().endsWith("/social/sites.aspx"))a.CurrentMainLinkElementID=_allSitesLinkId;else if(b.toLowerCase().endsWith("/social/sitesdocuments.aspx"))a.CurrentMainLinkElementID=_allDocumentsLinkId}break;default:a.CurrentMainLinkElementID=_allSitesLinkId}}function IsReasonableUrl(a){if(typeof a!="string"||a=="")return false;return true}function ExtractItemsFromMenu(menuElement,itemsContainer){function UrlFromOnclick(a){if(a==null)return a;else return _jsProtocol+"SuiteOnClick("+STSScriptEncodeWithQuote(a)+")"}if(menuElement!=null){var menuItems=menuElement.getElementsByTagName("ie:menuitem");if(menuItems==null||menuItems.length==0)menuItems=menuElement.getElementsByTagName("menuitem");for(var l=menuItems.length,previousGroupId,i=0;i<l;i++){var menuItem=menuItems[i],hiddenScript=menuItem.getAttribute("hidden"),itemHidden=hiddenScript!=null&&Boolean(eval(hiddenScript)),itemType=menuItem.getAttribute("type");if(!itemHidden&&itemType=="option"){var groupId=menuItem.getAttribute("menugroupid");if(previousGroupId!==groupId){previousGroupId!=null&&itemsContainer.push(null);previousGroupId=groupId}itemsContainer.push({Id:"SuiteMenu_"+menuItem.id,MenuName:null,Sublinks:null,TargetWindow:null,Text:menuItem.getAttribute("text"),Url:UrlFromOnclick(menuItem.getAttribute("onmenuclick"))})}}}}function AddMenuItemsFromDOM(a){if(a.UserDisplayName==null){var f=document.getElementById("SuiteNavUserName");if(f!=null&&Boolean(f.innerHTML))a.UserDisplayName=f.innerHTML}var i="\\U002F",j={welcomeItems:[],settingsItems:[]},k=document.getElementById("suiteMenuData");if(k==null)return j;for(var l=k.getElementsByTagName("menu"),o=j.welcomeItems,n=l.length,g=0;g<n;g++){var c=l[g];if(c.id.indexOf("PersonalActionMenu")>=0){if(a.CurrentWorkloadUserSubLinks==null)a.CurrentWorkloadUserSubLinks=[];var d=[];ExtractItemsFromMenu(c,d);for(var m=d.length,h=0;h<m;h++){var b=d[h],e="";if(b!=null&&b.Url!=null)e=b.Url.toUpperCase();if(e.indexOf(i+"SIGNOUT.ASPX")>=0){if(a.SignOutLink!=null)a.SignOutLink.Url=b.Url;if(a.SignOutLink.Text==null)a.SignOutLink.Text=b.Text}else e.indexOf(i+"PERSON.ASPX")<0&&a.CurrentWorkloadUserSubLinks.push(b)}}else if(c.id.indexOf("SiteActionsMenu")>=0){if(a.CurrentWorkloadSettingsSubLinks==null)a.CurrentWorkloadSettingsSubLinks=[];ExtractItemsFromMenu(c,a.CurrentWorkloadSettingsSubLinks)}}}function UpdateHelpLink(a){var b=typeof g_navBarHelpDefaultKey=="undefined"?"HelpHome":g_navBarHelpDefaultKey;if(a.HelpLink!=null)a.HelpLink.Url=_jsProtocol+"TopHelpButtonClick("+STSScriptEncodeWithQuote(b)+")"}function RegisterEventHandlers(){var a=O365Shell.Host.OnContextMenuPopup(function(a){a&&MenuHtc_hide()});AddEvtHandler(window,"onunload",function(){O365Shell.Host.RemoveOnContextMenuPopup(a);O365Shell.Host.FlushTaskRunnerQueue()})}function SetSuiteNavSize(a){try{if(a!=null&&localStorage.SPSuiteNavHeight!=null)a=localStorage.SPSuiteNavHeight;document.getElementById(suiteLinksDiv).style.height=a}catch(b){}}function GetCachedColors(){var b=GetLocalStorageValue(_themeInfoKey);if(b!=null)for(var c=JSON.parse(b),a=0;a<document.styleSheets.length;a++){var d=document.styleSheets[a];if(c.Url==d.href)return c.Colors}return []}function AllowCoBranding(){var a=GetWebTemplate(),b=a==_mySiteHostWebTemplate||a==_mySitePersonalWebTemplate;return b}function UpdateThemeColors(g){var o=AllowCoBranding();if(g==null||o&&Boolean(g.HasTenantBranding)||GetWebTemplate()==_tenantAdminWebTemplate)return;if(!o)g.UseSPOBehaviors=true;var c=GetCachedColors();if(c==null||c.length==0)c=[];else{g.ThemeColors=c;return}function p(b,a){c[b]=a}function d(e,c){var a=c.backgroundColor,d=Boolean(a);if(d){if(a.toLowerCase()=="transparent"&&c.filter!=null){var b=/startColorstr=(#[0-9A-F]*),/ig.exec(c.filter);if(b!=null&&b.length>1)a="#"+b[1].substr(3)}p(e,a)}return d}function e(c,b){var a=Boolean(b.color);a&&p(c,b.color);return a}var j={},k=0;function b(b,c){for(var a=0;a<b.length;a++)j[b[a]]=c;k++}var a=browseris.ie8down?".ms-core-neediefilter ":"";b(["#suitebarleft"],function(b){a===""&&d(0,b);return e(10,b)});a!==""&&b([a+"#suitebarleft"],function(a){return d(0,a)});b([a+".ms-core-suitelink-a:hover"],function(a){return d(1,a)});b(["a.ms-core-suitelink-disabled, a.ms-core-suitelink-disabled:hover","a.ms-core-suitelink-disabled"],function(a){return !Boolean(a.padding)&&e(2,a)});b([a+".ms-core-menu-item:hover, "+a+".ms-core-menu-itemselected",a+".ms-core-menu-item:hover"],function(a){return d(3,a)});a!==""&&b([a+"#suitebarright"],function(a){return d(4,a)});b(["#suitebarright"],function(b){a===""&&d(4,b);return e(5,b)});b(["a.ms-core-menu-link"],function(a){return e(7,a)});b(["a.ms-core-suitelink-active, a.ms-core-suitelink-active:hover, .ms-core-neediefilter a.ms-core-suitelink-active, .ms-core-neediefilter a.ms-core-suitelink-active:hover","a.ms-core-suitelink-active"],function(a){var b=a.borderRightColor;c[9]=b!=null&&b!=""?b:a.borderLeftColor;e(6,a);return d(8,a)});for(var f=0,q="",u=new Date,l=0;l<document.styleSheets.length&&f<k;l++){f=0;var h=document.styleSheets[l];q=h.href;var m=h.rules!=null?h.rules:h.cssRules;if(!Boolean(m))continue;for(var n=m.length-1;n>0&&f<k;n--){var i=m[n];if(i.style!=null&&i.selectorText!=null){var s=i.selectorText.toLowerCase(),r=j[s];if(r!=null&&r(i.style)){j[s]=null;f++}}}}if(f>0){g.ThemeColors=c;var t={Url:q,Colors:c};SetLocalStorageValue(_themeInfoKey,JSON.stringify(t))}}var _shellJsFailedToLoad=false,_alreadyRenderedShell=false;function RenderFullSuite(b){if(Boolean(RenderSuiteLinksFromShellData.ShellJson))b=RenderSuiteLinksFromShellData.ShellJson;if(suiteLinksDiv==null||_alreadyRenderedShell)return;var a=null;try{if(b!=null)a=ExtractSuiteMetadata(b)}catch(c){}if(a==null||!IsReasonableUrl(a.CssUrl)||!(IsReasonableUrl(a.JsUrl)||a.JsKey!=null))With15FallbackShellData(RenderFullSuiteFromDataObject);else RenderFullSuiteFromDataObject(a)}function RenderFullSuiteFromDataObject(b){try{var f=Boolean(RenderSuiteLinksFromShellData.ShellJson)?null:JSON.stringify(b),a=ExtractSuiteNavBarData(b);UpdateActiveLink(a);var g=b.CssUrl,h=b.JsUrl;registerCssLink(g);function d(){if(!_shellJsFailedToLoad&&!_dataRetrieved){_shellJsFailedToLoad=true;if(!_fetchingData){ClearSuiteLinksCache();LoadShellRenderedSuite()}}else{_shellJsFailedToLoad=true;With15FallbackShellData(RenderFullSuiteFromDataObject)}}function e(){if(typeof O365Shell=="undefined"){d();return}else _shellJsFailedToLoad=false;if(!Boolean(RenderSuiteLinksFromShellData.ShellJson))RenderSuiteLinksFromShellData.ShellJson=f;try{SetSuiteNavSize();AddMenuItemsFromDOM(a);UpdateHelpLink(a);UpdateThemeColors(a)}catch(c){}var b=document.getElementById(suiteLinksDiv);b!=null&&typeof RemoveCssClassFromElement!="undefined"&&RemoveCssClassFromElement(b,"ms-TopBarBackground-bgColor");O365Shell.SetData(a);var e={top:suiteLinksDiv,disableDelayLoad:true,layout:"Mouse"};O365Shell.Render(e,function(){SP.SOD.notifyEventAndExecuteWaitingJobs("SPSuiteLinksRendered",[a]);RegisterEventHandlers()});_alreadyRenderedShell=true}if(typeof O365Shell=="undefined"){if(typeof RenderSuiteLinksFromShellData.JsVer=="undefined")RenderSuiteLinksFromShellData.JsVer=0;var c="o365shell_js"+RenderSuiteLinksFromShellData.JsVer++;if(b.JsKey==null)SP.SOD.registerSod(c,h);else c=b.JsKey;SP.SOD.executeFunc(c,"O365Shell",e,d)}else e();SP.SOD.execute("core.js","UpdateCompanyDisplayName",a)}catch(i){}}function LoadShellRenderedSuite(){GetSuiteLinks(FetchLinksFromServer,Boolean(dataCallback)?dataCallback:RenderFullSuite,suiteVersion)}if(suiteVersion<2)if(typeof EnsureScriptParams!=="undefined")EnsureScriptParams("suitelinks.js","RenderSuiteLinks",suiteLinksDiv,FetchLinksFromServer,UpdateActiveLink);else typeof GetSuiteLinks!=="undefined"&&GetSuiteLinks(FetchLinksFromServer,dataCallback);else{SetSuiteNavSize();LoadShellRenderedSuite()}}function SuiteOnClick(a){a!=null&&SP.SOD.executeFunc("core.js","ExecuteOnClick",function(){if(IsSafeHref(a))STSNavigate(a);else ExecuteOnClick(a)})}function RetrieveAndProcessSuiteNavData(a,b){RenderSuiteLinksFromShellData(null,b,a,true)}typeof NotifyScriptLoadedAndExecuteWaitingJobs!=="undefined"&&NotifyScriptLoadedAndExecuteWaitingJobs("SpoSuiteNav.js")